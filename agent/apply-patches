#!/bin/bash

if [[ -f ./patch_flag ]];then
    echo "agent patched!"
    exit 0
fi

tar -zxvf agent-1.11.1.tar.gz
cp -fr ./agent-1.11.1/* ./
rm -rf ./agent-1.11.1
cat ./series.conf | while read line
do
    if [[ $line == '' || $line =~ ^\s*# ]]; then
        continue
    fi
    echo "====patch $line======"
    pwd
    patch -p1 -F1 -s < ./patches/$line
done
touch ./patch_flag
